version: '3'

vars:
  IMAGE_TAG: 'rexasi-tracker/tracker'
  DOCKER_COMPOSE_CMD: 'docker compose'
  DOCKER_FLAGS: '--network rexasi-tracker --rm -it'

  DATA_VOLUME: '/path/to/bag-files/folder'

includes:
  setup: ./tasks/setup.yml
  detectors: ./tasks/detectors.yml

env:
  DOCKER_BUILDKIT: 1 

tasks:

  setup:
    cmds:
      - task setup:clean
      - task setup:init-network
      - task setup:build-image
      - task detectors:build

  start:
    cmds:
      - '{{.DOCKER_COMPOSE_CMD}} -f docker/docker-compose.yaml up'

  start/example:
    cmds:
      - xhost local:root
      - '{{.DOCKER_COMPOSE_CMD}} -f example/docker-compose.yaml up'

  rviz:
    cmds:
      - xhost local:root
      - '{{.DOCKER_COMPOSE_CMD}} -f docker/docker-compose.rviz.yaml up -d'

  bash:
    cmds:
      - docker run {{.DOCKER_FLAGS}} {{.IMAGE_TAG}} bash

  replay:
    vars:
      BAG_FILE: 'bag-file-folder-name'
    cmds:
      - docker run {{.DOCKER_FLAGS}} -v {{.DATA_VOLUME}}:/data {{.IMAGE_TAG}} ros2 bag play -l -r 0.5 /data/{{.BAG_FILE}}

  record:
    vars:
      BAG_FILE: 'output'
    cmds:
      - docker run {{.DOCKER_FLAGS}} -v {{.DATA_VOLUME}}:/data {{.IMAGE_TAG}} ros2 bag record -a -o /data/{{.BAG_FILE}}
