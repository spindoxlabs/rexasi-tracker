version: '3'

vars:
  BASE_IMAGE_TAG: 'rexasi-tracker/base'

tasks:

  clean:
    cmds:
      - sudo rm -rf build install log resource
      - mkdir -p data
      - sudo chmod -R 777 ./data

  init-network:
    cmds:
      - docker network create rexasi-tracker | true

  build-base-image:
    cmds:
      - docker build -f docker/Dockerfile.base . -t {{.BASE_IMAGE_TAG}}

  build-example:
    cmds:
      - '{{.DOCKER_COMPOSE_CMD}} -f ./example/docker-compose.yaml build'

  build-tracker:
    cmds:
      - '{{.DOCKER_COMPOSE_CMD}} -f ./docker/docker-compose.yaml build'

  build:
    cmds:
      - task setup:build-base-image 
      - task setup:build-tracker
      - task setup:build-example
      - task detectors:build

